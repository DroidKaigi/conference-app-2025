# Gradle CI Properties for Xcode Cloud
# Network and SSL configuration to resolve dependency download issues

# Critical: Disable ALL parallel execution and concurrent downloads
org.gradle.parallel=false
org.gradle.workers.max=1
org.gradle.max.workers=1
systemProp.org.gradle.internal.http.maxConnections=1
systemProp.org.gradle.internal.remote.connection.max.idle.time=120000
systemProp.org.gradle.internal.publish.checksums.insecure=true

# Extended timeouts for unstable connections (5 minutes)
systemProp.org.gradle.internal.http.connectionTimeout=300000
systemProp.org.gradle.internal.http.socketTimeout=300000
systemProp.sun.net.client.defaultConnectTimeout=300000
systemProp.sun.net.client.defaultReadTimeout=300000

# HTTP/HTTPS configuration for macOS CI environment
systemProp.http.keepAlive=false
systemProp.http.maxConnections=1
systemProp.https.protocols=TLSv1.2
systemProp.jdk.tls.client.protocols=TLSv1.2
systemProp.deployment.security.TLSv1.2=true

# Force IPv4 (Xcode Cloud has IPv6 issues)
systemProp.java.net.preferIPv4Stack=true
systemProp.java.net.preferIPv6Addresses=false

# Disable SSL certificate validation (CI only - required for Xcode Cloud)
systemProp.javax.net.ssl.trustStore=NONE
systemProp.javax.net.ssl.trustStoreType=Windows-ROOT
systemProp.jdk.http.auth.tunneling.disabledSchemes=""
systemProp.jdk.http.auth.proxying.disabledSchemes=""

# HTTP User Agent (some repos block default Gradle agent)
systemProp.http.agent=Gradle/8.0 (Macintosh; Intel Mac OS X)

# Gradle specific settings
org.gradle.configureondemand=false
org.gradle.daemon=false
org.gradle.caching=false
org.gradle.configuration-cache=false

# Kotlin specific settings
kotlin.incremental=false
kotlin.compiler.execution.strategy=in-process
kotlin.native.disableCompilerDaemon=true
kotlin.mpp.stability.nowarn=true

# Plugin repository configuration (required for Gradle Kotlin DSL)
systemProp.org.gradle.internal.repository.max.retries=0
systemProp.org.gradle.internal.repository.initial.backoff=500
systemProp.org.gradle.plugin.management.internal.verbose=true

# JVM settings with conservative memory allocation
org.gradle.jvmargs=-Xmx6g -XX:MaxMetaspaceSize=2g -XX:+HeapDumpOnOutOfMemoryError -Dfile.encoding=UTF-8 -Djava.net.preferIPv4Stack=true